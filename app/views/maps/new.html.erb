<div data-turbo="false" style="display: flex; height: 100vh; overflow: hidden;">
  <!-- LEFT SIDE: 40% width -->
  <div style="width: 40%; display: flex; flex-direction: column; background-color: white; padding: 24px;">

    <!-- HEADER (fixed) -->
    <header class="mb-6 flex-shrink-0" style="display: flex; justify-content: space-between; align-items: flex-start;">
      <div>
        <h1 class="text-4xl font-bold text-gray-800 mb-2">Carnet de Voyage</h1>
        <p class="text-sm text-gray-500">Transform your travel notes into interactive maps</p>
      </div>
      <div style="display: flex; gap: 8px;">
        <%= link_to "‚Üê Back to Maps", maps_path, class: "text-sm text-blue-600 hover:text-blue-800" %>
      </div>
    </header>

    <% if @map.errors.any? %>
      <div class="mb-4 p-3 flex-shrink-0" style="background-color: #fef2f2; border: 1px solid #fca5a5; border-radius: 0.125rem;">
        <p class="font-medium" style="font-size: 0.875rem; color: #991b1b;"><%= pluralize(@map.errors.count, "error") %> prevented this map from being saved:</p>
        <ul class="mt-2 text-sm list-disc list-inside" style="color: #991b1b;">
          <% @map.errors.each do |error| %>
            <li><%= error.full_message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <!-- Destination -->
    <div class="mb-4 p-3 flex-shrink-0" style="background-color: #eff6ff; border: 1px solid #bfdbfe; border-radius: 0.125rem;">
      <label style="font-size: 0.875rem; color: #1e40af; font-weight: 600;">üìç Destination:</label>
      <%= form_with model: @map, html: { style: "margin: 0;" } do |form| %>
        <%= form.text_field :title, style: "width: 100%; margin-top: 8px; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 0.125rem; font-size: 0.875rem;", placeholder: "New York City, USA" %>
    </div>

    <!-- Paste Your Text heading -->
    <h2 class="text-xl font-semibold mb-4 text-gray-700 flex-shrink-0">Paste Your Text</h2>

    <!-- Hidden fields -->
    <%= form.hidden_field :description %>
    <%= form.hidden_field :privacy, value: 'shared_with_link' %>

    <!-- Form with textarea and button (fills remaining space) -->
    <div class="flex-1 flex flex-col min-h-0">
      <%= form.text_area :original_text, class: "flex-1 p-4 border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none bg-white text-gray-900 min-h-0", style: "border-radius: 0.125rem;", placeholder: "Paste text containing place names, addresses, or landmarks...\n\nExample:\nNew York City\nGive me 5 great cocktail bars\n\n1. The Up & Up is a cocktail bar in the West Village...\n2. The Raines Law Room at The William..." %>
      <%= form.submit "Extract & Map Places", class: "mt-4 w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 transition duration-200 shadow-md flex-shrink-0", style: "border-radius: 0.125rem; border: none;" %>
    </div>
    <% end %>
  </div>

  <!-- RIGHT SIDE: 60% width - Map with Tokyo center -->
  <div style="width: 60%; position: relative; overflow: hidden;">
    <div id="preview-map" style="width: 100%; height: 100vh;"></div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const mapboxToken = document.querySelector('meta[name="mapbox-token"]').content;

    if (typeof mapboxgl !== 'undefined') {
      mapboxgl.accessToken = mapboxToken;

      const map = new mapboxgl.Map({
        container: 'preview-map',
        style: 'mapbox://styles/mapbox/streets-v12',
        center: [139.6917, 35.6895], // Tokyo coordinates
        zoom: 11
      });

      // Add navigation controls
      map.addControl(new mapboxgl.NavigationControl());
    }
  });
</script>
